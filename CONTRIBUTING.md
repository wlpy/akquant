# è´¡çŒ®æŒ‡å— (Contributing Guide)

æ„Ÿè°¢ä½ å¯¹ AKQuant çš„å…³æ³¨ï¼æˆ‘ä»¬éœ€è¦ä½ çš„å¸®åŠ©æ¥è®©è¿™ä¸ªé¡¹ç›®å˜å¾—æ›´å¥½ã€‚æ— è®ºä½ æ˜¯ä¿®å¤ Bugã€æ”¹è¿›æ–‡æ¡£ï¼Œè¿˜æ˜¯å¢åŠ æ–°åŠŸèƒ½ï¼Œæˆ‘ä»¬éƒ½éå¸¸æ¬¢è¿ï¼

ä¸ºäº†æ–¹ä¾¿â€œèŒæ–°â€ä¸Šæ‰‹ï¼Œæˆ‘ä»¬å‡†å¤‡äº†è¿™ä»½è¯¦ç»†çš„ GitHub åˆä½œå¼€å‘æŒ‡å—ã€‚

## ğŸš€ å¼€å‘æµç¨‹ (Workflow)

æˆ‘ä»¬é‡‡ç”¨ **Git Flow** çš„ç®€åŒ–æ¨¡å¼è¿›è¡Œå¼€å‘ã€‚

- **`main` åˆ†æ”¯**: ç¨³å®šåˆ†æ”¯ï¼Œå¯¹åº” PyPI å‘å¸ƒçš„ç‰ˆæœ¬ã€‚
- **`dev` åˆ†æ”¯**: å¼€å‘åˆ†æ”¯ï¼Œæ‰€æœ‰çš„æ—¥å¸¸å¼€å‘å’Œ PR éƒ½åº”åˆå¹¶åˆ°æ­¤åˆ†æ”¯ã€‚

### 1. Fork & Clone (å¤åˆ»ä¸å…‹éš†)

1.  **Fork é¡¹ç›®**: ç‚¹å‡» GitHub é¡µé¢å³ä¸Šè§’çš„ `Fork` æŒ‰é’®ï¼Œå°† `akquant` ä»“åº“å¤åˆ»åˆ°ä½ è‡ªå·±çš„è´¦å·ä¸‹ã€‚
2.  **Clone åˆ°æœ¬åœ°**:
    ```bash
    # å°† <your-username> æ›¿æ¢ä¸ºä½ çš„ GitHub ç”¨æˆ·å
    git clone https://github.com/<your-username>/akquant.git
    cd akquant
    ```
3.  **è®¾ç½®ä¸Šæ¸¸ä»“åº“ (Upstream)**:
    ä¸ºäº†ä¿æŒä½ çš„ä»£ç ä¸å®˜æ–¹ä»“åº“åŒæ­¥ï¼Œéœ€è¦æ·»åŠ ä¸Šæ¸¸ä»“åº“åœ°å€ï¼š
    ```bash
    git remote add upstream https://github.com/akfamily/akquant.git
    ```

### 2. ç¯å¢ƒæ­å»º (Setup)

æœ¬é¡¹ç›®æ··åˆäº† Rust å’Œ Pythonï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤é…ç½®ç¯å¢ƒï¼š

1.  **å®‰è£… Rust**: [å®˜ç½‘ä¸‹è½½](https://www.rust-lang.org/tools/install)
2.  **åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒ (æ¨è Conda)**:
    ```bash
    conda create -n akquant python=3.10
    conda activate akquant
    ```
3.  **å®‰è£…ä¾èµ–ä¸ç¼–è¯‘**:
    ```bash
    # å®‰è£…å¼€å‘ä¾èµ–
    pip install -e ".[dev,ml,plot]"

    # ç¼–è¯‘ Rust æ‰©å±• (å¼€å‘æ¨¡å¼)
    maturin develop
    ```

### 3. å¼€å§‹å¼€å‘ (Coding)

1.  **åŒæ­¥æœ€æ–°ä»£ç **:
    æ¯æ¬¡å¼€å‘å‰ï¼Œå…ˆç¡®ä¿ä½ çš„æœ¬åœ° `dev` åˆ†æ”¯æ˜¯æœ€æ–°çš„ï¼š
    ```bash
    git checkout dev
    git pull upstream dev
    ```

2.  **åˆ›å»ºåŠŸèƒ½åˆ†æ”¯**:
    **ä¸è¦**ç›´æ¥åœ¨ `dev` æˆ– `main` ä¸Šä¿®æ”¹ã€‚è¯·ä¸ºæ¯ä¸ªä»»åŠ¡åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ï¼š
    ```bash
    git checkout -b feature/my-new-feature
    # æˆ–è€…ä¿®å¤ bug
    git checkout -b fix/bug-fix-name
    ```

3.  **ç¼–å†™ä»£ç **:
    *   éµå¾ª PEP 8 ç¼–ç è§„èŒƒã€‚
    *   ç¡®ä¿æ·»åŠ äº†ç±»å‹æ³¨è§£ (Type Hints)ã€‚
    *   å¦‚æœæ˜¯ Python ä»£ç ï¼Œè¯·è¿è¡Œæ£€æŸ¥ï¼š
        ```bash
        ruff check .
        mypy .
        ```

### 4. æäº¤ä¸æ¨é€ (Commit & Push)

1.  **æäº¤ä»£ç **:
    ```bash
    git add .
    git commit -m "feat: æ·»åŠ äº†xxxåŠŸèƒ½"
    ```
    *(æ¨èä½¿ç”¨ [Conventional Commits](https://www.conventionalcommits.org/) æ ¼å¼)*

2.  **æ¨é€åˆ°ä½ çš„ Fork ä»“åº“**:
    ```bash
    git push origin feature/my-new-feature
    ```

### 6. æµ‹è¯•ä¸éªŒè¯ (Testing)

ä¸ºç¡®ä¿ä»£ç è´¨é‡ä¸å›æµ‹ç»“æœçš„ä¸€è‡´æ€§ï¼Œæœ¬é¡¹ç›®å¼•å…¥äº†**é»„é‡‘æµ‹è¯•å¥—ä»¶ (Golden Test Suite)**ã€‚

1.  **è¿è¡Œå¸¸è§„å•å…ƒæµ‹è¯•**:
    ```bash
    pytest
    ```

2.  **è¿è¡Œé»„é‡‘æµ‹è¯• (Golden Tests)**:
    é»„é‡‘æµ‹è¯•ç”¨äºæ•æ‰æ ¸å¿ƒç®—æ³•å˜æ›´å¯¼è‡´çš„éé¢„æœŸè¡Œä¸ºï¼ˆå¦‚ PnL è®¡ç®—ã€æ’®åˆé€»è¾‘å·®å¼‚ï¼‰ã€‚
    ```bash
    pytest tests/golden/test_golden.py
    ```
    *   å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥å·®å¼‚æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚
    *   å¦‚æœæ˜¯**é¢„æœŸå†…çš„ç®—æ³•æ”¹è¿›**ï¼ˆä¾‹å¦‚ä¿®å¤äº†æ’®åˆ bug å¯¼è‡´æˆäº¤ä»·æ ¼å˜åŠ¨ï¼‰ï¼Œä½ éœ€è¦æ›´æ–°åŸºçº¿ï¼š
        ```bash
        python tests/golden/runner.py --generate-baseline
        ```
        å¹¶åœ¨ PR ä¸­è¯´æ˜å¯¼è‡´åŸºçº¿å˜æ›´çš„åŸå› ã€‚

3.  **ä»£ç é£æ ¼æ£€æŸ¥**:
    ```bash
    ruff check .
    mypy .
    ```

---

## âœ… æäº¤å‰çš„æ£€æŸ¥æ¸…å•

åœ¨æäº¤ PR ä¹‹å‰ï¼Œè¯·æ£€æŸ¥ï¼š

- [ ] ä»£ç å¯ä»¥é€šè¿‡ `maturin develop` ç¼–è¯‘æˆåŠŸã€‚
- [ ] è¿è¡Œäº† `ruff check .` å’Œ `mypy .` æ²¡æœ‰æŠ¥é”™ã€‚
- [ ] å¦‚æœæ˜¯æ–°åŠŸèƒ½ï¼Œæ˜¯å¦æ·»åŠ äº†ç®€å•çš„æµ‹è¯•æˆ–ç¤ºä¾‹ï¼Ÿ
- [ ] æ–‡æ¡£æ˜¯å¦å·²æ›´æ–°ï¼Ÿ

## â“ é‡åˆ°é—®é¢˜ï¼Ÿ

å¦‚æœä½ åœ¨é…ç½®ç¯å¢ƒæˆ–æäº¤ä»£ç æ—¶é‡åˆ°å›°éš¾ï¼Œæ¬¢è¿åœ¨ [Issues](https://github.com/akfamily/akquant/issues) ä¸­æé—®ï¼Œæˆ‘ä»¬ä¼šå°½å¿«å›å¤ï¼

å†æ¬¡æ„Ÿè°¢ä½ çš„è´¡çŒ®ï¼ğŸ‰
